[config]
# 语言设置
language = "zh"
response_language = "zh-CN"  # PR 响应使用中文

# 使用最新的 Codex 模型
model = "gpt-5.2-codex"  # 最新最强
fallback_models = ["gpt-5.1-codex-max", "gpt-5-codex", "gpt-4o"]

# Token 限制（Codex 通常有很大的 context）
max_model_tokens = 200000  # 设置一个大值，PR Agent 会根据实际模型能力调整

# 推理强度（low/medium/high）
reasoning_effort = "high"

# 日志级别
verbosity_level = 2

# 输出配置
publish_output = true
publish_output_progress = true

# 大 PR 处理策略
large_patch_policy = "clip"  # "clip" 或 "skip"，clip 会裁剪而非跳过

# Bitbucket 特定配置（关键）
ai_timeout = 180  # Bitbucket 大 PR 需要更长超时（3 分钟）

# 过滤语言框架
# ignore_language_framework = ['protobuf']

# 动态上下文
# max_extra_lines_before_dynamic_context = 10

[ignore]
# 忽略文件
glob = [
    "*.exe",
    "*.dll",
    "*.dylib",
    "*.so",
    "*.syso",
    "*.a",
    "*.cat",
    "releases/*",
    "resources/**/*",  # 完全忽略 resources 目录
    "Log/*",
    "**/*.png",
    "**/*.jpg",
    "**/*.jpeg",
    "**/*.gif",
    "*.lock",
    "package-lock.json",
    "yarn.lock",
    "review_outputs/**/*",
    "WPFTest/bin/**/*",
    "WPFTest/obj/**/*",
]

[pr_reviewer]
# 调试
output_relevant_configurations = true
enable_help_text = false

# 审查功能
require_score_review = true
require_tests_review = true
require_security_review = true
require_estimate_effort_to_review = true
require_can_be_split_review = false
require_todo_scan = true

# 审查样式
inline_code_comments = true
persistent_comment = true
publish_output_no_suggestions = true

# 最大化评论数量（处理超大 PR）
num_max_findings = 200

# 标签
enable_review_labels_effort = true
enable_review_labels_security = true

[pr_code_suggestions]
# 代码建议数量（最大化）
num_code_suggestions = 30
suggestions_score_threshold = 0
focus_only_on_problems = false
persistent_comment = true

[pr_description]
# 大 PR 分批处理配置（处理超大 PR）
max_ai_calls = 50
async_ai_calls = true
enable_large_pr_handling = true

# 描述配置
publish_labels = false  # Bitbucket Pipeline 不支持标签
add_original_user_description = true
enable_pr_type = true
enable_semantic_files_types = true
collapsible_file_list = "adaptive"
enable_pr_diagram = true
final_update_message = true

[git_provider]
# Bitbucket 特定配置
force_update_from_diff = true

[bitbucket_app]
# 需要全量审核时，务必获取完整文件
avoid_full_files = false
